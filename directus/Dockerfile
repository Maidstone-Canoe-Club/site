FROM directus/directus:10.5

USER node
WORKDIR /directus

COPY . .

ARG DB_CLIENT
ARG DB_HOST
ARG DB_PORT
ARG DB_DATABASE
ARG DB_USER
ARG DB_PASSWORD
ARG ADMIN_EMAIL
ARG ADMIN_PASSWORD
ARG KEY
ARG SECRET
ARG PUBLIC_URL

ENV DB_CLIENT ${DB_CLIENT}
ENV DB_HOST ${DB_HOST}
ENV DB_PORT ${DB_PORT}
ENV DB_DATABASE ${DB_DATABASE}
ENV DB_USER ${DB_USER}
ENV DB_PASSWORD ${DB_PASSWORD}
ENV ADMIN_EMAIL ${ADMIN_EMAIL}
ENV ADMIN_PASSWORD ${ADMIN_PASSWORD}
ENV KEY ${KEY}
ENV SECRET ${SECRET}
ENV PUBLIC_URL ${PUBLIC_URL}

ARG PORT
ENV PORT ${PORT}
EXPOSE ${NITRO_PORT}

CMD npx directus bootstrap && \
    npx directus start
